<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/css/bootstrap.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename = 'styles.css') }}">
    <!--<script  rel="stylesheet" type="text/css" src="{{ url_for('static', filename='bootstrap/js/bootstrap.js') }}"></script>    <meta charset="UTF-8">-->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link href="headers.css" rel="stylesheet">
    <script src="static/game_manager.js"></script>
    <style>
        body {
            margin: 0;
            border: 0;
            padding: 0;
        }

    </style>
        
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Stream</title>
</head>
<body>
    <header class="p-3 bg-dark px-0">
        <div class="container">
            <div class="d-flex flex-wrap align-items-center justify-content-lg-start">
            <div class="col-2">
                <a href = "/">
                    <img src="{{ url_for('static', filename='GoStreamLogoTitleRight.png') }}" class ="GoStream" alt="Home" id="logo">
                </a>
            </div>   
                <ul class="col nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
                    <li>
                        <a href="{{ url_for('game') }}" class="nav-link px-2 custom-color">Game Mode</a>
                    </li>
                    <li>
                        <a href="{{ url_for('transparent') }}" class="nav-link px-2 custom-color">Transparent Mode</a>
                    </li>
                    <li>
                        <a href="{{ url_for('historique') }}" class="nav-link px-2 custom-color">History of games</a>
                    </li>
                    <li>
                        <a href="{{ url_for('sgf') }}" class="nav-link px-2 custom-color">Load from SGF</a>
                    </li>
                </ul>
                
                <div class="text-end custom-color custom-size px-2">
                    <b>Game Stream</b>
                </div> 
            
            </div>
        </div>

    </header>

    <div class="container">
        <div class="container text-center">
            <div class="row align-items-start">
                <form method="POST" action="/cam" id="myForm">
                    <button class="col btn btn-petit" type="submit" id="start-button" name="psw1" value="0">
                        Start recording
                    </button>
                    <button class="col btn btn-annuler" type="submit" id="stop-button" name="psw1" value="1" disabled>
                        Stop the camera
                    </button>
                </form>
            </div>
        </div>
        
        <div class="custom-container text-center">
            <div class="row">
                <div class="col">
                    
                    <div id="video-container">
                        <img id="camera-feed" src="" alt="Camera Feed">
                    </div>
                    
                    <div class="col text-info">
                        <div id="message">
                            {{ message }}
                        </div>
                    </div>
                
                </div>
                <div class="col px-0">

                    <img id="image" src="static/empty_board.jpg" alt="Image" class="px-0">

                    <form method="POST" action="/game" id="move" class="btn-group-lg">
                        <button class="btn btn-nav mx-1" id="initial">   &lt;&lt;  </button>     
                        <button class="btn btn-nav mx-1" id="previous">    &lt;   </button>     
                        <button class="btn btn-nav mx-1" id="next">    &gt;   </button>     
                        <button class="btn btn-nav mx-1" id="last">   &gt;&gt;  </button>
                    </form>
                </div>
                <div class="col-1 mx-0 px-0">
                        <form method="POST" action="/undo" class="px-0 mx-0 custom-form">
                            <button class="row btn btn-annuler" type="submit">
                                Undo
                            </button>
                        </form>
                        <button class="row btn btn-petit cu" onclick="downloadFile()">
                            Get SGF
                        </button>
                </div>
            
                <script>
                    function updateMessage() {
                        $.get('/update', function(data) {
                            // Mettre à jour le contenu de #message avec le nouveau message
                            $('#message').text(data.message);
                            $('#image img').attr('src', 'data:image/jpeg;base64,' + data.image); 
                        });
                    }
                    // Mettre à jour le message toutes les 3 secondes (ajustez selon vos besoins)
                    setInterval(updateMessage, 1000);
                </script>
            </div>
        </div>
  
        <!-- <div class="container-fluid text-center">
            <div class="row">


                <div class="col">
                    <form method="POST" action="/change_place" id="change">
                        <label for="input1">Ancien emplacement</label>
                        <input type="text" id="input1" name="input1" placeholder="par exemple A1..">
                        <br>
                        <label for="input2">Nouvel emplacement</label>
                        <input type="text" id="input2" name="input2" placeholder="par exemple S19..">
                        <br>
                        <button class="btn bg custom-button btn-petit" type="submit">Valider</button>
                    </form>
                </div>
            </div>
        </div> -->
    </div> 

    <script>
        function downloadFile() {
            // Requête AJAX pour obtenir le contenu du fichier depuis le serveur
            var xhr = new XMLHttpRequest();
            xhr.open('GET', '/get_sgf_txt', true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    // Créer un blob avec le contenu du fichier
                    var blob = new Blob([xhr.responseText], { type: 'text/plain' });
                    
                    // Utiliser FileSaver.js pour télécharger le fichier
                    saveAs(blob, 'partie.sgf');
                }
            };
            xhr.send();
        }
    </script>
    <footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top bg-dark">
        <div class="col align-items-center">
            <a href = "/" class="mb-3 me-2 mb-md-0 lh-1">
                <img src="{{ url_for('static', filename='GoStreamLogoWithoutTitle.png') }}" class ="GoStreamFooter" alt="Home" id="logo">
            </a>
            <span class="mb-3 mb-md-0 text-muted">© 2024 IMT Atlantique</span>
        </div>
        <div class="col text-end">
            <img src="{{ url_for('static', filename='client_logo.png') }}" class ="Tenuki" alt="Home" id="logo">
            <span class="mb-3 mb-md-0 text-muted">© Association Tenuki</span>
        </div>
        <div class="col-1"></div>
    </footer>
<!-- </div>  
    <div class="container-sm">

    </div>

</div>
</div>

</div>
<script>
    function updateMessage() {
        $.get('/update', function(data) {
            // Mettre à jour le contenu de #message avec le nouveau message
            $('#message').text(data.message);
            $('#image img').attr('src', 'data:image/jpeg;base64,' + data.image);
        
        });
    }

    // Mettre à jour le message toutes les 3 secondes (ajustez selon vos besoins)
    setInterval(updateMessage, 3000);
</script>

<script>
    function downloadFile() {
        // Requête AJAX pour obtenir le contenu du fichier depuis le serveur
        var xhr = new XMLHttpRequest();
        xhr.open('GET', '/get_file_content', true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {
                // Créer un blob avec le contenu du fichier
                var blob = new Blob([xhr.responseText], { type: 'text/plain' });
                
                // Utiliser FileSaver.js pour télécharger le fichier
                saveAs(blob, 'nom_du_fichier.sgf');
            }
        };
        xhr.send();
    }
</script>
<script>
    document.getElementById('rules').addEventListener('change', function() {
        if (this.checked) {
            document.getElementById('check').submit();
        }
    });
</script> 



            <div class="col text-left text-light">
                <form method="POST" action="/rules" id="check">
                    <label for="rules">Respect des règles strictes : </label>
                    <input type="checkbox" id="rules" name="psw3" value="6" {% if check == 'True' %}checked{% endif %}>
                </form>
                <br>
                <br>








        <script src="{{ url_for('static',filename = 'script.js') }}"></script>
    -->






</body>
</html>
 
